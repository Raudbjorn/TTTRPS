#!/bin/bash
# Direct UV test runner using uv run
# Usage: ./uv-test [test-file-or-directory]

set -e

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${BLUE}ğŸ§ª UV Test Runner${NC}"
echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

# Check for uv
if ! command -v uv &> /dev/null; then
    echo "âš ï¸  UV not found. Install from: https://github.com/astral-sh/uv"
    exit 1
fi

# Default test target
TEST_TARGET=${1:-tests/}

# Run different test commands based on argument
case "$1" in
    unit)
        echo -e "${GREEN}â–¶ Running unit tests...${NC}"
        uv run pytest tests/unit/ -v
        ;;
    integration)
        echo -e "${GREEN}â–¶ Running integration tests...${NC}"
        uv run pytest tests/integration/ -v
        ;;
    coverage)
        echo -e "${GREEN}â–¶ Running all tests with coverage...${NC}"
        uv run pytest tests/ --cov=src/mbed --cov-report=term-missing --cov-report=html
        echo -e "${BLUE}ğŸ“Š Coverage report saved to htmlcov/index.html${NC}"
        ;;
    fast)
        echo -e "${GREEN}â–¶ Running tests in parallel (fast mode)...${NC}"
        uv run pytest tests/ -n auto
        ;;
    watch)
        echo -e "${GREEN}â–¶ Running tests in watch mode...${NC}"
        uv run pytest-watch tests/ --clear
        ;;
    *)
        # Run specific test or all tests
        echo -e "${GREEN}â–¶ Running tests: $TEST_TARGET${NC}"
        uv run pytest "$TEST_TARGET" -v
        ;;
esac

echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${GREEN}âœ¨ Done!${NC}"